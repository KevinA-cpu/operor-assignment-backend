CREATE TABLE IF NOT EXISTS users (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    email VARCHAR(255),
    gender VARCHAR(20),
    ip_address VARCHAR(50),
    days INTEGER CHECK (days >= 1 AND days <= 50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS meetings (
    id SERIAL PRIMARY KEY,
    start_day INTEGER CHECK (start_day >= 1),
    end_day INTEGER CHECK (end_day >= start_day),
    user_id INTEGER REFERENCES users(id),
    room_id INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE OR REPLACE FUNCTION check_days() RETURNS TRIGGER AS $$
BEGIN
    IF NEW.end_day > (SELECT days FROM users WHERE id = NEW.user_id) THEN
        RAISE EXCEPTION 'End day cannot be greater than user days';
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER check_days_before_insert_or_update
BEFORE INSERT OR UPDATE OF end_day, user_id ON meetings
FOR EACH ROW EXECUTE PROCEDURE check_days();

--Data already fixed by changing the days of the users from 0 to 1 to pass the check
    INSERT INTO users (id, first_name, last_name, email, gender, ip_address, days) VALUES
	('1', 'Sarah', 'Labb', 'slabb0@gov.uk', 'Female', '3.235.170.252', '21'),
	('2', 'Jae', 'Scemp', 'jscemp1@loc.gov', 'Male', '234.93.146.47', '5'),
	('3', 'Teirtza', 'Gammack', 'tgammack2@wikispaces.com', 'Genderqueer', '215.153.191.101', '5'),
	('4', 'Gannie', 'Kitcatt', 'gkitcatt3@pen.io', 'Male', '88.191.249.157', '6'),
	('5', 'Niccolo', 'Keymer', 'nkeymer4@bing.com', 'Male', '16.50.166.107', '26'),
	('6', 'Friedrick', 'Avo', 'favo5@noaa.gov', 'Polygender', '85.67.103.187', '10'),
	('7', 'Baillie', 'Akker', 'bakker6@go.com', 'Male', '81.50.149.164', '1'),
	('8', 'Leif', 'Howsego', 'lhowsego7@unc.edu', 'Male', '214.94.126.227', '8'),
	('9', 'Lark', 'Whittock', 'lwhittock8@cbsnews.com', 'Female', '141.221.201.48', '16'),
	('10', 'Ulrick', 'Lockton', 'ulockton9@tripadvisor.com', 'Male', '52.196.181.188', '12'),
	('11', 'Sibbie', 'Stroyan', 'sstroyana@statcounter.com', 'Female', '99.157.129.185', '6'),
	('12', 'Brant', 'Porcher', 'bporcherb@w3.org', 'Male', '230.192.249.205', '1'),
	('13', 'Brandise', 'Feasley', 'bfeasleyc@hud.gov', 'Female', '166.179.220.201', '10'),
	('14', 'Cody', 'Fildery', 'cfilderyd@usgs.gov', 'Female', '241.105.203.32', '11'),
	('15', 'Franz', 'Saffle', 'fsafflee@sogou.com', 'Male', '200.37.144.65', '6'),
	('16', 'Phylis', 'Raddish', 'praddishf@blogs.com', 'Female', '24.2.143.68', '5'),
	('17', 'Boycie', 'Cuffe', 'bcuffeg@google.fr', 'Male', '76.26.141.27', '12'),
	('18', 'Chiquita', 'Pollett', 'cpolletth@ovh.net', 'Female', '222.195.79.74', '2'),
	('19', 'Darcey', 'L''Amie', 'dlamiei@ebay.com', 'Female', '42.135.57.141', '10'),
	('20', 'Zacharie', 'Pessler', 'zpesslerj@pcworld.com', 'Agender', '111.66.56.213', '7'),
	('21', 'Darn', 'Larvin', 'dlarvink@howstuffworks.com', 'Male', '137.190.10.123', '8'),
	('22', 'Lyle', 'Gogin', 'lgoginl@xinhuanet.com', 'Male', '185.221.196.45', '21'),
	('23', 'Ddene', 'Kennedy', 'dkennedym@so-net.ne.jp', 'Female', '145.217.140.74', '5'),
	('24', 'Adrienne', 'Cobelli', 'acobellin@vkontakte.ru', 'Female', '213.225.248.217', '3'),
	('25', 'Ambur', 'Alleburton', 'aalleburtono@surveymonkey.com', 'Female', '70.181.65.79', '10'),
	('26', 'Bernadene', 'Mazzei', 'bmazzeip@bigcartel.com', 'Female', '55.79.194.249', '5'),
	('27', 'Michel', 'Kembry', 'mkembryq@bing.com', 'Male', '98.146.183.101', '12'),
	('28', 'Mira', 'Pullan', 'mpullanr@ibm.com', 'Female', '34.89.218.197', '1'),
	('29', 'Tracie', 'Huffadine', 'thuffadines@sfgate.com', 'Male', '159.27.98.129', '7'),
	('30', 'Marrilee', 'Bims', 'mbimst@hibu.com', 'Polygender', '70.253.186.38', '13'),
	('31', 'Saxe', 'Adamek', 'sadameku@symantec.com', 'Male', '46.165.34.132', '8'),
	('32', 'Jameson', 'Ridings', 'jridingsv@hexun.com', 'Male', '250.178.95.87', '11'),
	('33', 'Jedidiah', 'Llewellin', 'jllewellinw@unesco.org', 'Genderqueer', '120.59.225.135', '9'),
	('34', 'Raphael', 'Jakovijevic', 'rjakovijevicx@ucsd.edu', 'Male', '192.245.57.166', '2'),
	('35', 'Diana', 'Ropkins', 'dropkinsy@comsenz.com', 'Female', '183.226.62.102', '12'),
	('36', 'Dana', 'De Gowe', 'ddegowez@cpanel.net', 'Female', '12.12.135.139', '4'),
	('37', 'Steffie', 'Depper', 'sdepper10@imageshack.us', 'Female', '142.142.204.18', '13'),
	('38', 'Stefania', 'Youd', 'syoud11@360.cn', 'Female', '122.25.94.109', '13'),
	('39', 'Tove', 'Garner', 'tgarner12@examiner.com', 'Female', '150.162.110.35', '6'),
	('40', 'Raimund', 'Jorin', 'rjorin13@freewebs.com', 'Agender', '163.27.60.41', '13'),
	('41', 'Waly', 'Midner', 'wmidner14@about.com', 'Female', '216.33.232.111', '1'),
	('42', 'Fara', 'Monketon', 'fmonketon15@vkontakte.ru', 'Female', '189.33.243.125', '3'),
	('43', 'Bonnee', 'Karlolczak', 'bkarlolczak16@webnode.com', 'Female', '141.25.54.135', '1'),
	('44', 'Christin', 'Tompkiss', 'ctompkiss17@toplist.cz', 'Female', '66.161.96.206', '15'),
	('45', 'Nataniel', 'Breeds', 'nbreeds18@senate.gov', 'Male', '201.180.46.183', '8'),
	('46', 'Wald', 'Ramage', 'wramage19@linkedin.com', 'Male', '208.252.249.146', '9'),
	('47', 'Xymenes', 'Verzey', 'xverzey1a@dion.ne.jp', 'Male', '185.231.226.5', '5'),
	('48', 'Derril', 'Tollady', 'dtollady1b@artisteer.com', 'Male', '188.185.27.78', '22'),
	('49', 'Saunderson', 'Toffolini', 'stoffolini1c@vk.com', 'Male', '79.201.25.174', '4'),
	('50', 'Murvyn', 'Halley', 'mhalley1d@globo.com', 'Male', '245.114.180.78', '7');

INSERT INTO meetings (id, start_day, end_day, user_id, room_id) VALUES
	('1', '5', '7', '6', '49'),
	('2', '20', '21', '22', '40'),
	('3', '2', '10', '19', '35'),
	('4', '6', '7', '22', '24'),
	('6', '1', '8', '38', '31'),
	('7', '3', '10', '5', '14'),
	('8', '1', '10', '30', '46'),
	('9', '8', '13', '40', '29'),
	('10', '10', '11', '32', '48'),
	('11', '8', '13', '9', '31'),
	('12', '1', '2', '8', '2'),
	('13', '2', '4', '26', '27'),
	('15', '1', '2', '31', '29'),
	('16', '9', '13', '22', '21'),
	('18', '5', '6', '44', '46'),
	('19', '12', '13', '30', '25'),
	('22', '4', '6', '32', '3'),
	('23', '4', '6', '8', '49'),
	('25', '2', '3', '22', '39'),
	('26', '9', '12', '17', '7'),
	('27', '21', '22', '48', '38'),
	('29', '1', '2', '18', '5'),
	('30', '3', '4', '31', '4'),
	('31', '5', '8', '5', '6'),
	('32', '3', '10', '40', '39'),
	('33', '7', '8', '8', '23'),
	('34', '4', '5', '22', '45'),
	('36', '4', '4', '44', '20'),
	('37', '1', '5', '46', '34'),
	('38', '9', '10', '13', '15'),
	('39', '1', '2', '10', '28'),
	('40', '6', '11', '37', '15'),
	('41', '3', '4', '10', '34'),
	('42', '5', '5', '10', '14'),
	('43', '5', '8', '38', '35'),
	('44', '3', '13', '38', '24'),
	('45', '1', '3', '20', '5'),
	('46', '7', '8', '45', '16'),
	('47', '6', '8', '46', '46'),
	('48', '12', '25', '5', '47'),
	('49', '1', '4', '17', '19'),
	('50', '10', '12', '27', '20'),
	('54', '5', '5', '17', '45'),
	('55', '9', '9', '32', '17'),
	('56', '2', '4', '14', '6'),
	('59', '1', '3', '6', '27'),
	('60', '5', '10', '48', '36'),
	('61', '1', '2', '9', '2'),
	('63', '5', '6', '31', '42'),
	('64', '1', '2', '11', '40'),
	('65', '11', '13', '44', '7'),
	('68', '7', '8', '10', '11'),
	('69', '1', '7', '29', '8'),
	('70', '1', '9', '35', '19'),
	('72', '2', '4', '3', '9'),
	('73', '1', '2', '45', '14'),
	('76', '7', '13', '37', '43'),
	('77', '1', '5', '47', '50'),
	('78', '1', '6', '4', '3'),
	('79', '11', '12', '35', '42'),
	('80', '1', '4', '33', '15'),
	('81', '10', '12', '10', '5'),
	('82', '15', '19', '48', '31'),
	('83', '5', '7', '20', '20'),
	('84', '6', '8', '21', '50'),
	('85', '6', '7', '17', '23'),
	('86', '1', '3', '39', '36'),
	('89', '5', '6', '50', '42'),
	('91', '1', '3', '3', '44'),
	('93', '2', '5', '13', '49'),
	('94', '1', '3', '27', '41'),
	('95', '6', '8', '14', '46'),
	('96', '1', '3', '50', '4'),
	('97', '9', '9', '14', '2'),
	('98', '19', '20', '1', '49'),
	('100', '1', '3', '26', '36'),
	('102', '5', '7', '25', '47'),
	('103', '1', '3', '25', '42'),
	('105', '6', '9', '33', '25'),
	('106', '11', '13', '38', '41'),
	('108', '14', '15', '44', '47'),
	('109', '9', '10', '6', '42'),
	('111', '25', '26', '5', '19'),
	('112', '6', '6', '15', '38'),
	('113', '9', '10', '25', '17'),
	('114', '1', '2', '21', '48'),
	('115', '5', '9', '1', '17'),
	('116', '3', '6', '45', '17'),
	('117', '3', '4', '21', '26'),
	('118', '5', '7', '13', '32'),
	('119', '4', '4', '50', '2'),
	('120', '5', '6', '11', '48');